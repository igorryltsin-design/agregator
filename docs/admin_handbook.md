# Руководство администратора Agregator

Документ содержит практический регламент сопровождения системы: роли, ежедневные процедуры, обслуживание и реакция на инциденты.

## 1. Роли и права

- **Администратор** - полный доступ к пользователям, системным настройкам и операциям.
- **Редактор/модератор** - работа с библиотекой и метаданными без критичных системных прав.
- **Наблюдатель** - просмотр и поиск без изменений данных.

Рекомендуется:

- отдельная персональная учетная запись для каждого сотрудника;
- запрет общего "дежурного" логина;
- регулярная ревизия неактуальных пользователей.

## 2. Ежедневные операции

1. Проверить состояние очереди задач.
2. Просмотреть ошибки в логах за сутки.
3. Контролировать доступность LLM/OCR контуров.
4. Проверить успешность резервного копирования.
5. Снять краткий операционный отчет (внутренний журнал).

## 3. Еженедельные операции

- Выборочная проверка новых документов и качества метаданных.
- Тест AI-поиска на контрольном наборе запросов.
- Проверка свободного места и объема кэшей.
- Проверка SLA критичных endpoint-ов.

## 4. Ежемесячные операции

- Ревизия пользователей, ролей, ACL коллекций.
- Учебное восстановление из резервной копии на стенде.
- Ревизия секретов и внешних ключей.
- Обновление эксплуатационной документации.

## 5. Импорт и каталогизация

Рекомендуемый порядок:

1. Подготовить целевую коллекцию.
2. Выполнить загрузку/сканирование.
3. Дождаться завершения задач.
4. Проверить:
   - извлеченный текст;
   - корректность типа материала;
   - наличие тегов и года/автора.
5. Выполнить контрольный поиск.

## 6. Обслуживание AI-поиска

- Проверять latency и процент fallback.
- Контролировать объем `ai_search_*` таблиц.
- По графику чистить устаревшие кеши.
- При ухудшении качества:
  - проверить доступность LLM;
  - пересчитать индексы;
  - проверить качество исходных текстов.

## 7. Резервное копирование

Минимальный набор:

- БД (`catalogue.db` или dump PostgreSQL)
- `runtime_settings.json`
- `library/`
- `logs/` (по политике хранения)

Требования:

- ежедневный backup;
- хранение нескольких поколений;
- проверка восстановления не реже 1 раза в месяц.

## 8. Процедура обновления

1. Backup.
2. Выкат новой версии.
3. Проверка миграций.
4. Smoke-тест.
5. Подтверждение пользователям.

Если ошибка критичная - выполнить rollback согласно `docs/deployment.md`.

## 9. Работа с инцидентами

### 9.1 Первичные шаги

1. Зафиксировать время, симптом, затронутые функции.
2. Проверить логи и состояние сервисов.
3. Определить: локальная проблема или системная деградация.

### 9.2 Восстановление

- Применить временный workaround.
- При необходимости откатить версию.
- Проверить целостность данных.

### 9.3 Пост-инцидент

- Описать RCA (root cause analysis).
- Внести изменения в регламент.
- Добавить автоматические проверки, если возможно.

## 10. Чек-лист приемки окружения

- [ ] Доступен `app` и ключевые API.
- [ ] Работают импорт, поиск, AI-поиск.
- [ ] Очереди задач завершаются корректно.
- [ ] Проверены права доступа (admin/editor/viewer).
- [ ] Выполнен тест резервного копирования и восстановления.
