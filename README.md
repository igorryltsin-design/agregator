# Agregator - локальный каталог научных материалов с AI-поиском

Agregator - локальное веб-приложение для хранения, обработки и поиска научных материалов: статей, диссертаций, книг, презентаций, изображений, аудио и связанных файлов.  
Система поддерживает классический поиск, AI-поиск с ответами и ссылками на источники, управление коллекциями и совместную работу через роли и ACL.

## Для чего нужен проект

- Свести разрозненные файлы в единый каталог.
- Автоматизировать извлечение текста и метаданных.
- Обеспечить быстрый поиск по локальной библиотеке без внешних облаков.
- Добавить AI-помощник для ответов на вопросы по базе документов.
- Дать администраторам инструменты контроля, мониторинга и резервного копирования.

## Ключевые возможности

- Импорт файлов вручную и через сканирование каталогов.
- Извлечение текста из PDF/DOCX/изображений, транскрибация аудио.
- Классификация материалов, генерация тегов, работа с коллекциями.
- Полнотекстовый и фасетный поиск с фильтрами по авторам, годам, типам, тегам.
- AI-поиск: подбор релевантных фрагментов, генерация ответа, отображение источников.
- Админ-панель: управление пользователями, очередями задач, кэшами, настройками.
- Встроенный редактор `AiWord` для подготовки научных текстов.

## Технологический стек

- **Backend:** Python 3.11+, Flask, SQLAlchemy, Alembic.
- **Frontend:** React + TypeScript (Vite), отдельные UI для основного приложения и `AiWord`.
- **Хранилище:** SQLite (legacy/default в простых инсталляциях), PostgreSQL (рекомендуемый прод-режим).
- **AI/ML:** LM Studio/OpenAI-compatible API, OCR (Tesseract), аудио-обработка (ffmpeg, faster-whisper).
- **Инфраструктура:** Docker Compose, опционально Ansible/systemd для выката без Docker.

## Быстрый старт

### Вариант A: локальный запуск (Python)

```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
cp .env.example .env
python app.py
```

Интерфейс: `http://localhost:5050/app`

### Вариант B: Docker Compose

```bash
docker compose build
docker compose up -d
```

Интерфейс: `http://localhost:5050/app`

## Минимальная конфигурация

Перед первым запуском проверьте:

- `FLASK_SECRET_KEY` - уникальный секрет приложения.
- `SCAN_ROOT` - путь к библиотеке материалов.
- `DEFAULT_ADMIN_USER`, `DEFAULT_ADMIN_PASSWORD` - первичный администратор.
- `LMSTUDIO_API_BASE`, `LMSTUDIO_MODEL`, `LMSTUDIO_API_KEY` - если нужны AI-функции.
- `TRANSCRIBE_ENABLED`, `TRANSCRIBE_MODEL_PATH` - если нужна транскрибация аудио.

## Документация

Основные документы находятся в `docs/`:

- `docs/setup_guide.md` - подробная установка и первичная проверка.
- `docs/deployment.md` - варианты деплоя и обновления.
- `docs/architecture.md` - архитектура и поток обработки данных.
- `docs/readme_ai.md` - устройство классического и AI-поиска.
- `docs/ai_search_operations.md` - эксплуатация AI-поиска, метрики, обслуживание.
- `docs/admin_handbook.md` - регламенты администратора и чек-листы.
- `docs/training_resources.md` - программа обучения и сценарии презентации.
- `docs/postgres_migration.md` - переход SQLite -> PostgreSQL.
- `docs/security_audit.md` - результаты аудита безопасности и рекомендации.
- `docs/ux_metrics.md` - UX-метрики и шаблон проверки перед релизом.
- `docs/smoke_test_report.md` - шаблон и пример smoke-тестирования.

## Структура репозитория

- `app.py` - основной Flask-сервер, точка входа приложения.
- `routes.py` - API-роуты и вспомогательные обработчики.
- `agregator/` - сервисные слои (поиск, фасеты, HTTP-клиент, кэши, задачи).
- `frontend/` - основной веб-интерфейс.
- `AiWord/` - встроенный редактор научных текстов.
- `docs/` - документация по эксплуатации и развитию.
- `scripts/` - утилиты диагностики, миграции, упаковки.
- `tests/` - тесты backend и функциональных сценариев.

## Рекомендации по эксплуатации

- Храните `.env` вне Git и регулярно ротируйте ключи.
- Делайте резервные копии `catalogue.db`/PostgreSQL, `runtime_settings.json`, `library/`.
- После обновлений проверяйте поиск, AI-поиск, импорт, админ-панель и очереди задач.
- Для прод-окружений используйте отдельную БД PostgreSQL и регламент обновлений.

## Лицензия

См. файл `LICENSE`.
